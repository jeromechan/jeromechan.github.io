<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Openfire Plugin开发指南（一） &middot; Jerome Chan
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/assets/css/poole.css">
  <link rel="stylesheet" href="/assets/css/syntax.css">
  <link rel="stylesheet" href="/assets/css/hyde.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-precomposed.png">
                                 <link rel="shortcut icon" href="/assets/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="theme-base-08 layout-reverse">

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/">
          Jerome Chan
        </a>
      </h1>
      <p class="lead">Hello, I&acutem a web developer at Tuniu Corp. Follow my <a href='https://github.com/jeromechan' target='_blank'>GitHub</a>.</p>
    </div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item" href="/">Home</a>
<!-- 
      

      
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/about/">About Me</a>
          
        
      
        
      
        
          
            <a class="sidebar-nav-item" href="/pages/bibliography.html">读过的书目</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="/categories/">Categories</a>
          
        
      
        
      
        
          
        
      
        
          
        
      
        
      
        
      
        
          
            <a class="sidebar-nav-item" href="/slides/">Slides</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="/tags/">Tags</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="/timeline/">Timeline</a>
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
       -->

      <a class="sidebar-nav-item" href="/about/">About Me</a>
      <a class="sidebar-nav-item" href="/bibliography/" target="_blank">Bibliography</a>
      <a class="sidebar-nav-item" href="/slides/">Slides</a>
      <a class="sidebar-nav-item" href="/tags/">Tags</a>
      <a class="sidebar-nav-item" href="/categories/">Category</a>
      <a class="sidebar-nav-item" href="/timeline/">Timeline</a>
      <!-- <a class="sidebar-nav-item" href="https://github.com/jeromechan">GitHub</a> -->
      <!-- <span class="sidebar-nav-item">Currently v2.1.0-u-jeromechan-01</span> -->
    </nav>

    <p><small>Copyright &copy; 2013-2016</small></p>
  </div>
</div>


    <div class="content container">
      <div class="post">
  <h1 class="post-title">Openfire Plugin开发指南（一）</h1>
  <span class="post-date">17 May 2015</span>
  <p><strong>一、简介</strong></p>

<p>Openfire plugin使得Openfire自身的功能得到了很好的扩展和增强。这篇文档旨在引导开发者如何进行Openfire plugin的开发。</p>

<p><strong>二、plugin的结构</strong></p>

<p>plugin的源码放置在Openfire源码根目录的plugins目录下。当plugin以jar包或者war包的形式部署了之后，它将会自动解压成原始的文件夹层级结构，类似的plugin目录结构如下：</p>

<p>Plugin Structure</p>

<div class="highlighter-rouge"><pre class="highlight"><code>myplugin/	
|- plugin.xml &lt;- Plugin定义文件	
|- readme.html &lt;- 可选，插件说明文件，直接呈现给最终的用户阅读	
|- changelog.html &lt;- 可选，插件变更日志文件，直接呈现给最终的用户阅读	
|- logo_small.gif &lt;- 可选，插件的小号Logo图片(16x16)，只支持.gif和.png格式	
|- logo_large.gif &lt;- 可选，插件的大号Logo图片(32x32)，只支持.gif和.png格式	
|- classes/ &lt;- 插件所需要的资源文件 (类似地，例如插件的属性配置文件)	
|- database/ &lt;- 可选，插件的数据库模型文件，可内置包含数据库版本升级的模型文件	
|- i18n/ &lt;- 可选，插件的i18n多语言支持文件	
|- lib/ &lt;- 插件所依赖的库（即JAR包）	
|- web &lt;- 可选，插件的控制台页面相关文件	
|- WEB-INF/
|- web.xml &lt;- 生成的web.xml，包含了等待编译的jsp配置
|- web-custom.xml &lt;- 可选，用户自定义的web.xml，包含用户的servlets配置
|- images/ &lt;- 可选，插件的控制台页面所需要的图片资源文件，只支持.gif与.png格式
</code></pre>
</div>

<p>plugin中的web目录提供的是插件在管理员控制台中的管理功能，下面会撰写更为详细的相关内容。 其中，plugin.xml定义了plugin主要的类，下面是一个例子：<!-- more --></p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="c">&lt;!-- Sample plugin.xml --&gt;</span>
<span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;plugin&gt;</span>
<span class="c">&lt;!-- Main plugin class --&gt;</span>
<span class="nt">&lt;class&gt;</span>org.example.ExamplePlugin<span class="nt">&lt;/class&gt;</span>

<span class="c">&lt;!-- Plugin meta-data --&gt;</span>
<span class="nt">&lt;name&gt;</span>Example Plugin<span class="nt">&lt;/name&gt;</span>
<span class="nt">&lt;description&gt;</span>This is an example plugin.<span class="nt">&lt;/description&gt;</span>
<span class="nt">&lt;author&gt;</span>Jive Software<span class="nt">&lt;/author&gt;</span>

<span class="nt">&lt;version&gt;</span>1.0<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;date&gt;</span>07/01/2006<span class="nt">&lt;/date&gt;</span>
<span class="nt">&lt;url&gt;</span>http://www.igniterealtime. org/projects/openfire/plugins.jsp<span class="nt">&lt;/url&gt;</span>
<span class="nt">&lt;minServerVersion&gt;</span>3.0.0<span class="nt">&lt;/minServerVersion&gt;</span>
<span class="nt">&lt;licenseType&gt;</span>gpl<span class="nt">&lt;/licenseType&gt;</span>

<span class="c">&lt;!-- Admin console entries --&gt;</span>
<span class="nt">&lt;adminconsole&gt;</span>
<span class="c">&lt;!-- More on this below --&gt;</span>
<span class="nt">&lt;/adminconsole&gt;</span>
<span class="nt">&lt;/plugin&gt;</span>
</code></pre>
</div>

<p>以下的这一些元数据字段可以在plugin.xml被设置：</p>

<ul>
  <li>
    <p>name：plugin的名称</p>
  </li>
  <li>
    <p>description：plugin的描述</p>
  </li>
  <li>
    <p>author：plugin的作者</p>
  </li>
  <li>
    <p>version：plugin的版本号</p>
  </li>
  <li>
    <p>date：发布plugin的日期，格式必须是MM/dd/yyyy，类似地“07/01/2006”</p>
  </li>
  <li>
    <p>url：关于plugin更详尽信息的超链接</p>
  </li>
  <li>
    <p>minServerVersion：plugin所支持的Openfire最低版本号，假如版本号高于当前运行的Openfire版本，plugin将不会被启动</p>
  </li>
  <li>
    <p>databaseKey：假如plugin需要自己的数据库表，那么databaseKey节点必须要设置一个schema name（通常地，schema name设置成与plugin名称相同）。对于每一类Openfire所支持的数据库，数据库的schema文件都必须放置在plugin下的database目录下。例如：plugin名称为“foo”，那么该plugin的schema文件命名应该类似与“foo_mysql.sql”，“foo_oracle.sql”等。我们推荐把数据库表的命名都增加Openfire的前缀“of”，避免与同一数据库中的其他应用的数据库表结构的命名相冲突。在schema脚本文件中，应该在ofVersion表中增加一条记录，使得Openfire可以跟踪plugin的版本信息，类似地：INSERT INTO ofVersion (name, version) VALUES (‘foo’, 0);</p>
  </li>
  <li>
    <p>databaseVersion：数据库schema版本号（PS：当一个数据库被定义之时就具有的）。新的plugin在定义其数据库之时，数据库版本号将从0开始计数。假使在后面版本的plugin需要升级其数据库结构，那么升级的schema脚本文件需要放置到目录database/upgrade的每一个升级版本的文件夹下，目录结构类似地：database/upgrade/1和database/upgrade/2可以包含文件“foo_mysql.sql”与“foo_oracle.sql”，文件内包含了每一个版本的数据库结构的相关变更项目。在每一项数据库发生升级之时，都需要把ofVersion中的plugin版本记录更新，类似地：UPDATE ofVersion set version=1 where name=’foo’;</p>
  </li>
  <li>
    <p>parentPlugin：plugin的父插件的名称（）。当plugin拥有一个父插件（parent plugin），那么当前plugin将使用它父插件的类加载器，而不是自己新增一个类加载器。这一机制使得插件之间工作起来变得更加紧密。一个作为子节点的插件，如果没有其父插件的存在，它将无法独立工作。</p>
  </li>
  <li>
    <p>licenseType：定义着当前插件的官方所遵循的协议。有效的数值类似地：（1）“commercial”：插件的发布与传衍遵循着商业的协议</p>
  </li>
  <li>
    <p>“gpl”：the GNU Public License（GPL）</p>
  </li>
  <li>
    <p>“apache”：the Apache License</p>
  </li>
  <li>
    <p>“internal”：限制在内部使用，并且不准备二次发布传衍</p>
  </li>
  <li>
    <p>“other”：plugin所遵循的协议不在所列的协议范围之内，那么便可以使用other项，在其中需要撰写清楚相关协议的细节假设plugin没有指定任何协议，那么插件默认指定为other项。</p>
  </li>
</ul>

<p>在plugin中还有一些额外的文件，给用户提供了更多的信息（这些文件都放置在了plugin的根目录下）：</p>

<ul>
  <li>
    <p>readme.html：可选，插件的说明文件，呈现给最终用户阅读</p>
  </li>
  <li>
    <p>changelog.html：可选，插件的变更文件，呈现给最终用户阅读</p>
  </li>
  <li>
    <p>logo_small.png：可选，插件的logo小图片，仅限于.png和.gif格式</p>
  </li>
  <li>
    <p>logo_large.png：可选，插件的logo大图片，仅限于.png和.gif格式</p>
  </li>
  <li>
    <p>plugin的类文件必须实现Openfire API中所定义的Plugin接口，自然地，类文件有默认的一个无参数的构造器。plugin的类文件实现了Plugin接口中的initializing和destroying接口。</p>
  </li>
</ul>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="c1">// plugin的实现例子</span>
<span class="kn">package</span> <span class="n">org</span><span class="o">.</span><span class="na">example</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.jivesoftware.openfire.container.Plugin</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.jivesoftware.openfire.container.PluginManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>
<span class="cm">/**
* A sample plugin for Openfire.
*/</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExamplePlugin</span> <span class="kd">implements</span> <span class="n">Plugin</span> <span class="o">{</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">initializePlugin</span><span class="o">(</span><span class="n">PluginManager</span> <span class="n">manager</span><span class="o">,</span> <span class="n">File</span> <span class="n">pluginDirectory</span><span class="o">)</span> <span class="o">{</span>
<span class="c1">// Your code goes here</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kt">void</span> <span class="nf">destroyPlugin</span><span class="o">()</span> <span class="o">{</span>
<span class="c1">// Your code goes here</span>
<span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p><strong>常用的plugin最佳实践</strong></p>

<p>在选择一个插件的包名之时，我们推荐可以选择一些具备唯一性的标识，类似地，可以选用你的自定义字符串或者是组织名称来尽可能地避免包或者类命名的冲突。</p>

<p>例如，假设每个人使用的包名都是org.example.PluginName，就算是PluginName是不相同的，但是你依然会遇到这里或那里的类名冲突，这不是玩笑，在集群部署环境之下，该问题尤其突出。</p>


</div>

<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
          <a href="/2016/07/22/easy-chosing-opensource-license/">
            如何快速选择开源软件协议
            <small>22 Jul 2016</small>
          </a>
      </li>
    
      <li>
          <a href="/2016/07/22/resolve-the-fastjson-problems-about-date/">
            解决fastjson反序列化日期0000-00-00失败的方案
            <small>22 Jul 2016</small>
          </a>
      </li>
    
      <li>
          <a href="/2016/07/06/what-is-architecture/">
            什么是架构
            <small>06 Jul 2016</small>
          </a>
      </li>
    
      <li>
          <a href="/2016/07/02/talk-about-middleman/">
            说说使用middleman的那些事情
            <small>02 Jul 2016</small>
          </a>
      </li>
    
      <li>
          <a href="/2016/07/01/how-to-make-a-project-plan/">
            学习笔记：项目管理之规划项目
            <small>30 Jun 2016</small>
          </a>
      </li>
    
      <li>
          <a href="/2015/11/16/work-in-git/">
            Git软件开发过程
            <small>16 Nov 2015</small>
          </a>
      </li>
    
  </ul>
</div>

<div id="disqus_thread"></div>
<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */
    /*
    var disqus_config = function () {
        this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() {  // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        
        s.src = '//aboutcoder.disqus.com/embed.js';
        
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
    </div>

  </body>

  <div style="display:none;">
	<script src="http://s23.cnzz.com/z_stat.php?id=1252898702&web_id=1252898702" language="JavaScript"></script>
</div>
  
</html>
